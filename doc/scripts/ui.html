<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2002-2003 by Lutz Sammer

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; version 2 dated June, 1991.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Stratagus Configuration Language Description: User Interface (UI)</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
    <meta name="Author" content="johns98@gmx.net">
    <meta name="Keyword" content="ccl,tileset">
    <meta name="Description" content="">
</head>
<body>
    <h1>Stratagus Configuration Language Description: User Interface (UI)</h1>
<hr><pre width=80>
         _________ __                 __                               
        /   _____//  |_____________ _/  |______     ____  __ __  ______
        \_____  \\   __\_  __ \__  \\   __\__  \   / ___\|  |  \/  ___/
        /        \|  |  |  | \// __ \|  |  / __ \_/ /_/  >  |  /\___ \ 
       /_______  /|__|  |__|  (____  /__| (____  /\___  /|____//____  >
               \/                  \/          \//_____/            \/ 
    ______________________                           ______________________
			  T H E   W A R   B E G I N S
	   Stratagus - A free fantasy real time strategy game engine
</pre>
<p><b>(C) Copyright 2002-2003 by The Stratagus Project. Distributed under the
<a href="../gpl.html">"GNU General Public License"</a></b>
<hr>
<a href="../stratagus.html">Stratagus</a> 
<a href="../readme.html">Readme</a> 
<a href="../faq.html">FAQ</a> 
<a href="ccl.html">CCL</a> 
<a href="triggers.html">PREV</a> 
<a href="unittype.html">NEXT</a> 
<a href="ccl-index.html">Index</a> 
<hr>
<a href="#add-button">add-button</a>
<a href="#set-selection-changed-hook">set-selection-changed-hook</a>
<a href="#set-selected-unit-changed-hook">set-selected-unit-changed-hook</a>
<a href="#set-choose-target-begin-hook">set-choose-target-begin-hook</a>
<a href="#set-choose-target-finish-hook">set-choose-target-finish-hook</a>
<a href="#add-button">add-button</a>
<a href="#remove-button">remove-button</a>
<a href="#remove-all-buttons">remove-all-buttons</a>

<a href="#command-patrol">command-patrol</a>
<a href="#command-harvest">command-harvest</a>
<a href="#command-attack">command-attack</a>
<a href="#command-cancel-upgrade">command-cancel-upgrade</a>
<a href="#command-build">command-build</a>
<a href="#command-train-unit">command-train-unit</a>
<a href="#command-cast-spell">command-cast-spell</a>
<a href="#command-move">command-move</a>
<a href="#command-stop">command-stop</a>
<a href="#command-research">command-research</a>
<a href="#command-unload">command-unload</a>
<a href="#command-upgrade-to">command-upgrade-to</a>
<a href="#command-attack-ground">command-attack-ground</a>
<a href="#command-return-goods">command-return-goods</a>
<a href="#command-cancel">command-cancel</a>
<a href="#command-cancel-building">command-cancel-building</a>
<a href="#command-cancel-train-unit">command-cancel-train-unit</a>
<a href="#command-repair">command-repair</a>
<a href="#command-stand-ground">command-stand-ground</a>
<a href="#command-demolish">command-demolish</a>

<a href="#check-allowed">check-allowed</a>
<a href="#get-cost-string">get-cost-string</a>

<a href="#selected-is-building">selected-is-building</a>
<a href="#selected-is-training">selected-is-training</a>
<a href="#selected-is-upgrading">selected-is-upgrading</a>
<a href="#selected-get-race">selected-get-race</a>
<a href="#selected-get-speed">selected-get-speed</a>
<a href="#selected-owned-by-player">selected-owned-by-player</a>
<a href="#selected-mixed-units">selected-mixed-units</a>
<a href="#selected-get-action">selected-get-action</a>
<a href="#selected-resource-loaded">selected-resource-loaded</a>
<a href="#selected-draw-buttons">selected-draw-buttons</a>

<a href="#define-cursor">define-cursor</a>
<a href="#define-font">define-font</a>
<a href="#define-font-colors">define-font-colors</a>
<a href="#define-menu">define-menu</a>
<a href="#define-menu-graphics">define-menu-graphics</a>
<a href="#define-menu-item">define-menu-item</a>
<a href="#define-ui">define-ui</a>
<a href="#define-viewports">define-viewports</a>
<a href="#display-picture">display-picture</a>
<a href="#process-menu">process-menu</a>
<a href="#set-game-cursor!">set-game-cursor!</a>
<hr>
<h2>Intro - Introduction to UI functions and variables</h2>

Everything around the user interface.
<h2>Functions</h2>
<a name="add-button"></a>
<h3>(add-button 'tag1 value1 'tag2 value2 ...)</h3>

Add a button to the button panel during the game. This is usually
called from the 'button-hook of the unittypes (FIXME link), or from
the selection-changed-hook (FIXME link) directly.
See also (remove-all-buttons) (FIXME link)<br>
Possible tags:

<dl>
<dt>pos</dt>
<dd>Position number. Currently buttons can be added only to the button
panel.
<pre>
0 1 2
3 4 5
6 7 8
</pre>
</dd>
<dt>icon</dt>
<dd>Name of the icon to display.
</dd>
<dt>action</dt>
<dd>Script to eval when the button is pressed.
</dd>
<dt>key</dt>
<dd>Shortcut key for the button.
</dd>
<dt>hint</dt>
<dd>Hint to be displayed for the button.
</dd>
<dt>highlight</dt>
<dd>If given and true, highlight the button by drawing an extra border
(used for showing actions).
</dd>
</dl>

<h4>Example</h4>
<pre>
    ;; add a patrol button
    (add-button 'pos 4
      'icon (string-append "icon-" (selected-get-race) "-patrol-land")
      'key "p" 'hint "~!PATROL"
      'action (lambda () (command-patrol)))
</pre>

<a name="remove-button"></a>
<h3>(remove-button id)</h3>
Remove button number id.
<h4>Example</h4>
    (remove-button 4)
<pre>
</pre>

<a name="remove-all-buttons"></a>
<h3>(remove-all-buttons)</h3>
Removes all buttons from the button panel.

<a name="set-selection-changed-hook"></a>
<h3>(set-selection-changed-hook '(begin ...))</h3>
Set the script that will be evaluated whenever the player selects an other set of units.
You will probably want call things like <a href="#remove-all-buttons">remove-all-buttons</a>
and <a href="#add-button">add-button</a> here, after examining the selection with other helper functions.
<p>
I suggest you define a helper function that rebuilds the buttons, and
call it from both selection-changed-hook and 
<a href="#set-selected-unit-changed-hook">selected-unit-changed-hook</a>.

<h4>Example</h4>
<pre>
    ; (Those are extracts from the demogame ccls)

    ; FIXME: this is most likely a very ugly hack to scheme
    (define (set-global symbol value)
      (set-symbol-value! symbol value nil))
    (define (get-global symbol)
      (symbol-value symbol nil))

    (set-selection-changed-hook '(begin
      (set-global 'button-level 0)
      (rebuild-buttons)))

    (set-selected-unit-changed-hook '(begin
      (rebuild-buttons)))

    ; Build all the command buttons from scratch.
    (define (rebuild-buttons)
      (remove-all-buttons)
      (if (selected-owned-by-player) (begin
        ; draw some generic buttons
        (if (= (get-global 'button-level) 0) (begin
          (if (> (selected-get-speed) 0) (begin
            (generic-movement-buttons)
            (if (selected-mixed-units) (begin
              (generic-combat-buttons))
              ; Uniform selection: draw the unit's own buttons
              (selected-draw-buttons))))
          (if (selected-is-building) (begin
            ; there can be only one building selected
            ; no common buttons should be here for now, 
            ; "destroy building" or something could be added.
            (add-button 'pos 7
              'icon 'icon-move-peasant
              'key "m" 'hint "SET ~!MOVE"
              'action (lambda () (command-move)))
            ;
            ; Call the building's own button-draw hook
            ;
            (selected-draw-buttons)
            ; FIXME: maybe non-buildings could be upgrading too
            ; note: upgrade is both researching and changing unit type
            (if (selected-is-upgrading) (begin
              ; could be optimized by not calling (selected-draw-buttons)
              (remove-all-buttons)
              (add-button 'pos 9 'icon 'icon-cancel
                'key "\033" 'hint "~<ESC~> CANCEL UPGRADE"
                'action (lambda() (command-cancel-upgrade))))))))
        (begin ; else: button level is not zero
          ;
          ; Generic cancel button to go back to button level 0
          ;
          (add-button 'pos 9 'icon 'icon-cancel
            'key "\033" 'hint "~<ESC~> CANCEL"
            'action (lambda()
              (set-global 'button-level 0)
              (rebuild-buttons)))
          ;
          ; Call the unit's own button-draw hook
          ;
          (selected-draw-buttons))))))
    ; no command buttons for enemy units.
</pre>

<a name="set-selected-unit-changed-hook"></a>
<h3>(set-selected-unit-changed-hook)</h3>

Set the script that will be evaluated when one of the selected units
experiences some kind of upgrade, or when a global research is
completed (this is when you might want new buttons to appear, or old
ones to remove, or button images to be changed). This is seperated
from <a href="#set-selection-changed-hook">set-selection-changed-hook</a>
because you probably don't want to break out of a subbutton (eg selecting
the building to build) here.

<h4>Example</h4>
<pre>
    (set-selected-unit-changed-hook '(begin
      (writes nil "[debug] selected-unit-changed-hook called")
      (rebuild-buttons)))
</pre>

<a name="set-choose-target-begin-hook"></a>
<h3>(set-choose-target-begin-hook)</h3>

Set the script that will be evaluated when the user is asked to select
some target. You will want to change the buttons. FIXME: other hooks
can interrupt the select-target process, so a global flag must be set

<h4>Example</h4>
<pre>
    ; When doing a target selection, only draw a cancel button.
    ; If you leave them both empty, you can choose another building while
    ; setting the destination and similar things.
    (set-choose-target-begin-hook '(begin
      (set-global 'button-level 9)
      (rebuild-buttons)))
    (set-choose-target-finish-hook '(begin
      (set-global 'button-level 0)
      (rebuild-buttons)))
</pre>

<a name="set-choose-target-finish-hook"></a>
<h3>(set-choose-target-finish-hook)</h3>
Set the script that will be evaluated when the user has finished to
select a target. See <a href="#set-choose-target-begin-hook">set-choose-target-begin-hook</a>
for details.

<a name="command-patrol"></a>
<h3>(command-patrol)</h3>
(While game is running) Let the player select a destination where the
currently selected units will patrol to.

<a name="command-harvest"></a>
<h3>(command-harvest)</h3>
(While game is running) Let the player select a destination where the
currently selected units will harvest.

<a name="command-attack"></a>
<h3>(command-attack)</h3>
(While game is running) Let the player select a destination where the
currently selected units will attack.

<a name="command-cancel-upgrade"></a>
<h3>(command-cancel-upgrade)</h3>
(While game is running) Cancel the upgrade the currently selected unit
is doing.

<a name="command-build"></a>
<h3>(command-build unittype)</h3>
(While game is running) Let the player select a destination where a
building will be placed. Costs are checked.
<h4>Example</h4>
<pre>
    (command-build 'unit-farm)
</pre>

<a name="command-train-unit"></a>
<h3>(command-train-unit unittype)</h3>
(While game is running) Let the current unit train another unit (I
wonder whether this works with non-buildings, too?)
<h4>Example</h4>
<pre>
    ; define a helper function to add training buttons
    (define (train-button type pos key hint)
      (if (check-allowed (string-append 'unit- type))
        (add-button
          'icon (string-append 'icon- type)
          'hint (string-append hint "   " (get-cost-string (string-append 'unit- type)))
          'pos pos
          'key key
          'action (lambda ()
            (writes nil "Train-command\n")
            (command-train-unit  (string-append 'unit- type))))))
</pre>

<a name="command-cast-spell"></a>
<h3>(command-cast-spell spellid)</h3>
(While game is running) Let the current unit(selection) cast a spell.
<br>FIXME: untested.

<h4>Example</h4>
<pre>
    FIXME
</pre>

<a name="command-move"></a>
<h3>(command-move)</h3>
(While game is running) Let the player select a destination where the
currently selected units will move to.

<a name="command-stop"></a>
<h3>(command-stop)</h3>
(While game is running) stop the selected units.

<a name="command-research"></a>
<h3>(command-research upgrade)</h3>
(While game is running) Command the selected unit to research the
given upgrade.

<a name="command-unload"></a>
<h3>(command-unload)</h3>
(While game is running) Let the player select a destination where the
currently selected unit(s) will unload to.

<a name="command-upgrade-to"></a>
<h3>(command-upgrade-to unittype)</h3>
(While game is running) Command the selected unit to upgrade to
another unittype.

<a name="command-attack-ground"></a>
<h3>(command-attack-ground)</h3>
(While game is running) Let the player select a destination where the
currently selected unit(s) will attack a ground area.

<a name="command-return-goods"></a>
<h3>(command-return-goods)</h3>
(While game is running) Let the currently selected units return their
goods.

<a name="command-cancel"></a>
<h3>(command-cancel)</h3>
(While game is running) This cancels selecting a
destination. (FIXME: or is it used elsewhere too?)

<a name="command-cancel-building"></a>
<h3>(command-cancel-building)</h3>
(While game is running) This cancels building.
(FIXME: does it work?)

<a name="command-cancel-train-unit"></a>
<h3>(command-cancel-train-unit)</h3>
(While game is running) Let the first selected unit remove one item
from the training queue. 
(FIXME: or does it rather empty the training queue completely?)

<a name="command-repair"></a>
<h3>(command-repair)</h3>
(While game is running) Let the player select a destination that the
currently selected units will repair.

<a name="command-stand-ground"></a>
<h3>(command-stand-ground)</h3>
Command the selected units not to move. (FIXME: correct?)

<a name="command-demolish"></a>
<h3>(command-demolish)</h3>
(While game is running) Let the player select a destination where the
currently selected units go demolishing (explode there).

<a name="check-allowed"></a>
<h3>(check-allowed thing)</h3>
Check whether thing is allowed. Thing can be an upgrade or an unit.
<h4>Example</h4>
<pre>
    (if (check-allowed 'unit-keep)
      (add-button 'pos 2
      'icon 'icon-keep
      'key "k" 
      'hint (string-append "UPGRADE TO ~!KEEP   " (get-cost-string 'unit-keep))
      'action (lambda () (command-upgrade-to 'unit-keep))))
</pre>

<a name="get-cost-string"></a>
<h3>(get-cost-string thing)</h3>
Returns a string with the costs of thing (unit or upgrade), useful to
give as button hint.
<br>
The string contains the special characters like
&quot;$1&quot; that will let a resource icon appear instead of the
text.

<h4>Example</h4>
<pre>
      'hint (string-append "UPGRADE TO ~!KEEP   " (get-cost-string 'unit-keep))
</pre>

<a name="selected-is-building"></a>
<h3>(selected-is-building)</h3>
Returns true if the selected unit is a building. FIXME: bad name

<a name="selected-is-training"></a>
<h3>(selected-is-training)</h3>
Returns true if the selected unit is training.

<a name="selected-is-upgrading"></a>
<h3>(selected-is-upgrading)</h3>
Returns true if the selected unit is upgrading.

<a name="selected-get-race"></a>
<h3>(selected-get-race)</h3>
Returns the race of the selected unit.
<h4>Example</h4>
<pre>
    ; not yet used, could be useful for something like
    'icon (string-append "icon-" (selected-get-race) "shield1")
    ; if the icons are named properly
</pre>

<a name="selected-get-speed"></a>
<h3>(selected-get-speed)</h3>

Gets the speed of the selected unit, as defined in the
unittype. Useful to decide whether to draw a movement button. 
<br>
Note that the speed declared in the unittype is just to display something,
the real unit speed is hidden in the animation script.

<a name="selected-owned-by-player"></a>
<h3>(selected-owned-by-player)</h3>

Returns true if the selected unit(s) is owned by the current
player.
<br>
Note that the player cannot select more than one enemy unit a
a time.

<a name="selected-mixed-units"></a>
<h3>(selected-mixed-units)</h3>
Returns true if the selection contains more than one unittype.
<h4>Example</h4>
<pre>
    (if (selected-mixed-units) (begin
      ; attack/stand/patrol buttons for mixed selections
        (generic-combat-buttons))
      ; Uniform selection: draw the unit's own buttons
        (selected-draw-buttons))
</pre>

<a name="selected-get-action"></a>
<h3>(selected-get-action)</h3>
Returns the name of the current action as a string. Possible values are:
<p>
Invalid (No unit selected), Mixed (multiple units selected, and they
are doing different things), None, Still, StandGround, Follow, Move,
Attack, AttackGround, Die, SpellCast, Train, Train, UpgradeTo,
Research, Builded, Board, Unload, Patrol, Build, Repair, Resource,
ReturnGoods, Demolish.
<p>
Note that those are case-sensitive.

<h4>Example</h4>
<pre>
    (add-button 'pos 3
      'icon (string-append "icon-sword1")
      'key "a" 'hint "~!ATTACK"
      'highlight (= (strcmp (selected-get-action) 'Attack) 0)
      'action (lambda () (command-attack))))
</pre>

<a name="selected-resource-loaded"></a>
<h3>(selected-resource-loaded)</h3>
Returns the name of the resource the selected units have loaded, 
'mixed if there are different resources loaded, or nil (false) if
there are no resources loaded.
<h4>Example</h4>
<pre>
    (if (selected-resource-loaded) (begin
      (writes nil (string-append "[debug] Selected unit has loaded " (selected-resource-loaded) " resources.\n"))
      (add-button 'pos 6 
        ; could build icon string from the resource name :)
        'icon 'icon-return-goods-peasant
        'key "g" 'hint "RETURN WITH ~!GOODS"
        'action (lambda () (command-return-goods)))))
</pre>

<a name="selected-draw-buttons"></a>
<h3>(selected-draw-buttons)</h3>
Run the 'add-buttons hook from the first selected unittype.

<a name="define-cursor"></a>
<h3>(define-cursor 'ident 'race 'tag1 value1 'tag2 value2 ...)</h3>

Define a cursor.

<dl>
<dt>ident</dt>
<dd>Unique identifier of the cursor, used to reference it in config files and
during startup.
</dd>
<dt>race</dt>
<dd>Race to use this cursor with or "any" to use with any race.
</dd>
</dl>
Possible tags:
<dl>
<dt>image</dt>
<dd>Path to the image graphic.
</dd>
<dt>hot-spot</dt>
<dd>Hot spot of the cursor in pixels, in the form '(x y). Relative to the sprite origin (0,0). The
hot spot of a cursor is the point to which Stratagus refers in tracking the
cursor's position.
</dd>
<dt>size</dt>
<dd>Size of the cursor in pixels, in the form '(width height).
</dd>
<dt>rate</dt>
<dd>Rate of changing the frames if using an animated cursor. The "rate" tells
the engine how many milliseconds to hold each frame of the animation.
</dd>
</dl>

<h4>Example</h4>
<pre>
    ;; defines the cross cursor for any race
    (define-cursor 'cursor-cross 'any
      'image "ui/cursors/small green cross.png"
      'hot-spot '(8 8) 'size '(18 18))
</pre>

<a name="define-font"></a>
<h3>(define-font type file sizex sizey)</h3>

Define a font.

<dl>
<dt>type</dt>
<dd>Type of font.  Supported types are: 'game, 'small, 'large, 'small-title,
and 'large-title.
</dd>
<dt>file</dt>
<dd>File name for font file.  Currently only multicolor bitmap fonts supported.
</dd>
<dt>size</dt>
<dd>Font size width and height.
</dd>
</dl>

<h4>Example</h4>
<pre>
    ;; define the game font
    (define-font 'game "graphics/ui/fonts/game.png" 13 14)
</pre>

<a name="define-font-color"></a>
<h3>(define-font-color color array)</h3>

Define the font colors.<br>
FIXME: write something here if you understand it... where are those colors used?
What's the relation with the palette?

<dl>
<dt>color</dt>
<dd>Name of the color.
</dd>
<dt>array</dt>
<dd>Name of the color.
Array of 7 rgb colors #( r1 g1 b1 r2 g2 b2 ...)<br>
The colors are:
<table>
<tr><td>#0   </td><td>is background color</td></tr>
<tr><td>#1   </td><td>is the light font color</td></tr>
<tr><td>#2   </td><td>is the middle (main) font color</td></tr>
<tr><td>#3   </td><td>is the dark font color</td></tr>
<tr><td>#4   </td><td>is the font/shadow antialias color</td></tr>
<tr><td>#5   </td><td>is the dark shadow color</td></tr>
<tr><td>#6   </td><td>is the light shadow color</td></tr>
<tr><td>#255 </td><td>is transparent</td></tr>
</table>
</dd>
</ul>
</dl>

<h4>Example</h4>
<pre>
    (define-font-color 'yellow
                            ; FIXME: what are those? palette index?
      #( 252 248 240        ; 246
         244 224  32        ; 200
         208 192  28        ; 199
         168 140  16        ; 197
          92  48   0        ; 192
           0   0   0        ; 239
         108 108 108))      ; 104
</pre>

<a name="define-menu"></a>
<h3>(define-menu 'tag1 value1 'tag2 value2 ...)</h3>

FIXME: incomplete docu<br>
Possible tags:

<dl>
<dt>geometry</dt>
<dd>'(x y width height)
</dd>
<dt>name</dt>
<dd>Name of this menu.
</dd>
<dt>panel</dt>
<dd>Panel name (FIXME: how is it used?), or 'none.
</dd>
<dt>default</dt>
<dd>An integer. FIXME: what for? Default button, or what?
</dd>
<dt>netaction</dt>
<dd>Eg. 'terminate-net-connect.
</dd>
</dl>

<h4>Example</h4>
<pre>
    (define-menu 'name 'menu-sound-options 'geometry '(224 64 352 352)
      'panel 'panel5 'default '23)
</pre>

<a name="define-menu-graphics"></a>
<h3>(define-menu-graphics '(file filename size (w h)) ...)</h3>

Define the menu graphics for each of the races.

<dl>
<dt>filename</dt>
<dd>Path to the file containing the menu graphics.
</dd>
<dt>w, h</dt>
<dd>Width and height of an image in the menu graphic.
</dd>
</dl>

<h4>Example</h4>
<pre>
    (define-menu-graphics
      '(file "ui/buttons 1.png" size (300 144))
      '(file "ui/buttons 2.png" size (300 144)))
</pre>

<a name="define-menu-item"></a>
<h3>(define-menu-item 'tag1 value1 'tag2 value2 ...)</h3>

Add an item to a menu. This could be any item, it depends
on the tags used.<br>
FIXME: incomplete docu<br>
Example:
<pre>
    (define-menu-item 'pos (list 16 (- 288 40)) 'font 'large
      'button '(size (224 27)
        caption "Return to Game (~<Esc~>)"
        hotkey "esc"
        func game-menu-return
        style gm-full)
      'menu 'menu-game)
</pre>

Possible tags:

<dl>
<dt>pos</dt>
<dd>Position, in the form '(x y).
</dd>
<dt>menu</dt>
<dd>Menu this item belogs to.
</dd>
<dt>flags</dt>
<dd>Most likely '(disabled). 
Other possibilities: '(active), '(clicked), '(selected).
FIXME: are the paranthesis really needed?
</dd>
<dt>font</dt>
<dd>Font name (see <a href="#define-font">define-font</a>).
</dd>
<dt>init</dt>
<dd>Init function (there are a couple of
hardcoded C funtions allowed, like 'save-replay-init or
'scen-select-init).
</dd>
<dt>exit</dt>
<dd>Exit funtion (again some C functions like 'speed-options-exit or
'load-game-exit).
</dd>
<dt>text</dt>
<dd>The item is a text label. The value is a list of tags, for example: 
<pre>
    'text '(caption "Connecting to server" align center)
</pre>Allowed tags:
  <dl>
  <dt>align</dt>
  <dd>Left, right or center.
  </dd>
  <dt>caption</dt>
  <dd>The text.
  </dd>
  <dt>func</dt>
  <dd>C handler. FIXME: when called?
  </dd>
  <dt>color-normal</dt>
  <dd>FIXME.
  </dd>
  <dt>color-reverse</dt>
  <dd>FIXME.
  </dd>
  </dl>
</dd>
<dt>button</dt>
<dd>The item is a button. The value is a list of tags like
<pre>
    'button '(size (224 27)
      caption "~!Surrender"
      hotkey "s"
      func surrender-confirm-menu
      style gm-full)
</pre>
Allowed tags: align, caption, color-normal, color-reverse (see above)
and:
  <dl>
  <dt>size</dt>
  <dd>Dimensions (width height).
  </dd>
  <dt>func</dt>
  <dd>C handler. FIXME: when called?
  </dd>
  <dt>hotkey</dt>
  <dd>A string like &quot;f8&quot;.
  </dd>
  <dt>style</dt>
  <dd>Complete list of possible styles (not all for buttons):<br>
    main, network, gm-half, 132, gm-full, gem-round, gem-square,
    up-arrow, down-arrow, left-arrow, right-arrow, s-knob, s-vcont,
    s-hcont, pulldown, vthin, folder, sc-gem-round, sc-gem-square,
    sc-up-arrow, sc-down-arrow, sc-left-arrow, sc-right-arrow,
    sc-s-knob, sc-s-vcont, sc-s-hcont, sc-pulldown, sc-button-left,
    sc-button, sc-button-right
  <br>
  FIXME: describe them
  </dd>
  </dl>
</dd>
<dt>gem</dt>
<dd>The item is a gem.
Example:
<pre>
  'gem '(size (18 18)
    text "640 x 480"
    state unchecked
    func global-options-resolution-gem
    style gem-round)
</pre>
Allowed tags: size func style text color-normal color-reverse (see
above) and:
  <dl>
  <dt>state</dt>
  <dd>One of unchecked, passive, invisible or checked.
  </dd>
  </dl>
</dd>
<dt>pulldown</dt>
<dd>The item is a pulldown menu.
Example:
<pre>
    'pulldown '(size (152 20)
      style pulldown
      func null
      options ("Forest" "Winter" "Wasteland" "Orc Swamp" )
      default 0
      current 0)
</pre>
Allowed tags: size state default current (see above) and:
  <dl>
  <dt>options</dt>
  <dd>A list of strings to select from.
  </dd>
  <dt>func</dt>
  <dd>C handler. FIXME: when called?
  </dd>
  <dt>state</dt>
  <dd>The only possible value: passive
  </dd>
  <dt>default</dt>
  <dd>An integer for the default selection id, starting with 0.
  </dd>
  <dt>current</dt>
  <dd>An integer for the current selection id, starting with 0.
  </dd>
  </dl>
</dd>
<dt>listbox</dt>
<dd>The item is a list box.
Example:
<pre>
    'listbox '(size (288 108)
      style pulldown
      func scen-select-lb-action
      retopt scen-select-lb-retrieve
      handler scen-select-ok
      nlines 6)
</pre>
Allowed tags: size style default current color-normal color-reverse
(see above) and:
  <dl>
  <dt>func</dt>
  <dd>C handler. FIXME: when called?
  </dd>
  <dt>handler</dt>
  <dd>C handler. FIXME: when is it called?
  </dd>
  <dt>retopt</dt>
  <dd>C handler to retrieve the list of options, I guess.
  </dd>
  <dt>startline</dt>
  <dd>For scrolling, I guess. Probably only used in savegames.
  </dd>
  <dt>nlines</dt>
  <dd>Number of lines.
  </dd>
  </dl>
</dd>
<dt>vslider</dt>
<dd>The item is a vertical slider.
Example:
<pre>
    'vslider '(size (18 108)
      func editor-main-load-vs-action
      handler editor-main-load-ok)
</pre>
Allowed tags: size default current style (see above) and:
  <dl>
  <dt>func</dt>
  <dd>C handler. FIXME: when is it called?
  </dd>
  <dt>handler</dt>
  <dd>C handler. FIXME: when is it called?
  </dd>
  <dt>flags</dt>
  <dd>FIXME: never seen this used. Possible values: up, down, left, right, knob, cont
  </dd>
  <dt>startline</dt>
  <dd>For scrolling, I guess. Probably only used in savegames.
  </dd>
  <dt>nlines</dt>
  <dd>Number of lines.
  </dd>
  </dl>
</dd>
<dt>hslider</dt>
<dd>The item is a horizontal slider. See vslider above.
Example:
<pre>
  'hslider '(size (198 18)
    func master-volume-hs-action
    handler scen-select-ok)
</pre>
</dd>
<dt>drawfunc</dt>
<dd>The item is drawn from a C function. The value is the name of the
function.
Example:
<pre>
    (define-menu-item 'pos (list 0 0) 'font 'game  'init 'game-setup-init
      'drawfunc 'game-draw-func
      'menu 'menu-custom-game)
</pre>
</dd>
<dt>input</dt>
<dd>The item is a text input field.
Example:
<pre>
    'input '(size (212 20)
      func enter-master-action
      style pulldown)
</pre>
Allowed tags: size func style color-normal color-reverse (see above)
and:
  <dl>
  <dt>maxch</dt>
  <dd>Maximal number of characters. FIXME: never seen this used.
  </dd>
  <dt>func</dt>
  <dd>C handler, seems to be called when a key is pressed and
  just checks whether it is RETURN.
  </dd>
  </dl>
</dd>
</dl>

<a name="define-ui"></a>
<h3>(define-ui 'racename screen-width screen-height 'tag1 value1 'tag2 value2 ...)</h3>

This defines the position and sizes of the different user interface
sections. You probably want to make a function that takes the
resolution and the race as parameter.<br>
This is from a real example:
<pre>
    (define (make-ui race screen_width screen_height)
      ;; precalculate some ui positions for user interface at the bottom
      ; map area dimensions
      (define mapw (* 32 (trunc
        (/ screen_width 32))))
      (define maph (* 32 (trunc
        (/ (- screen_height 176 16 16) 32))))
                           ; |  |  ^ Ressource line
                           ; |  +--- Status line
                           ; +------ Buttons
      ; panels
      (define minimapx 0)
      (define minimapy (+ 16 maph))
      (define infox (+ minimapx 176))
      (define infoy minimapy)
      (define buttonx (+ infox 176))
      (define buttony infoy)
      (define fillerx (+ buttonx 176))
      (define fillery infoy)
      (define statusx 0)
      (define statusy (+ infoy 176))

      (define-ui race screen_width screen_height
        'normal-font-color (if (= race 'alliance) 'white 'yellow)
	;; ... and all the tags described below ...
    ))
    (make-ui 'alliance 640 480)
    (make-ui 'alliance 800 600)
    (make-ui 'alliance 1024 768)
    (make-ui 'alliance 1280 960)
    (make-ui 'alliance 1600 1200)
    
    (make-ui 'mythical 640 480)
    (make-ui 'mythical 800 600)
    (make-ui 'mythical 1024 768)
    (make-ui 'mythical 1280 960)
    (make-ui 'mythical 1600 1200)
</pre>

All of those tags should be given:

<dl>
<dt>normal-font-color</dt>
<dd>
<pre>
    'normal-font-color (if (= race 'alliance) 'white 'yellow)
</pre>
</dd>
<dt>reverse-font-color</dt>
<dd>
<pre>
    'reverse-font-color (if (= race 'alliance) 'yellow 'white)
</pre>
</dd>
<dt>filler</dt>
<dd>
<pre>
    'filler (list
      'file (string-append "graphics/ui/" race "/"
        (number->string screen_width) "x" (number->string screen_height)
        "/filler1.png")
      'pos (list fillerx fillery))
</pre>
</dd>
<dt>resource-line</dt>
<dd>
<pre>
    'resource-line (list
      (string-append "graphics/ui/" race "/"
        (number->string screen_width) "x" (number->string screen_height)
        "/resource.png")
      0 0)
</pre>
</dd>
<dt>resources</dt>
<dd>
<pre>
    'resources (list
      'gold (list 'file "graphics/ui/gold,wood,oil,mana.png" 'row 0
        'pos (list (+ 176   0) 0) 'size '(14 14) 'text-pos (list (+ 176   0 18) 1))
      'food (list 'file "graphics/ui/food.png" 'row 0
        'pos (list (- screen_width 16 138) 0) 'size '(14 14) 'text-pos (list (+ (- screen_width 16 138) 18) 1))
      'score (list 'file "graphics/ui/score.png" 'row 0
        'pos (list (- screen_width 16 68) 0) 'size '(14 14) 'text-pos (list (+ (- screen_width 16 68) 18) 1)))
</pre>
</dd>
<dt>info-panel</dt>
<dd>
<pre>
    'info-panel (list
      (string-append "graphics/ui/" race "/infopanel.png")
      infox infoy 176 176)
</pre>
</dd>
<dt>completed-bar</dt>
<dd>
<pre>
    'completed-bar (list
      'color 149
      'pos (list (+ infox 14) (+ infoy 151))
      'size '(152 14)
      'text "% Complete"
      'font 'game
      'text-pos (list (+ infox 14 38) (+ infoy 151)))
</pre>
</dd>
<dt>button-panel</dt>
<dd>
<pre>
    'button-panel (list
      (string-append "graphics/ui/" race "/buttonpanel.png")
      buttonx buttony)
</pre>
</dd>
<dt>map-area</dt>
<dd>
<pre>
    'map-area (list
      'pos '(0 16)
      'size (list mapw maph))
</pre>
</dd>
<dt>menu-panel</dt>
<dd>
<pre>
    'menu-panel (list
      (string-append "graphics/ui/" race "/menubutton.png")
      minimapx (+ minimapy 148))
</pre>
</dd>
<dt>minimap</dt>
<dd>
<pre>
    'minimap (list
      'file (string-append "graphics/ui/" race "/minimap.png")
      'panel-pos (list minimapx minimapy)
      'pos (list (+ minimapx 27) (+ minimapy 13))
      'size '(128 128)
      'transparent)
</pre>
There is a minimap panel an the minimap on it. The panel graphic has
certain palette restrictions (FIXME: exactly? probably the same as the
tileset?). Pos is the absoloute position of the minimap on the screen
(the upper left corner of it). If you give 'transparent, the panel
graphic will be displayed on unexplored terrain, black otherwise.
</dd>
<dt>status-line</dt>
<dd>
<pre>
    'status-line (list
      'file (string-append "graphics/ui/" race "/"
        (number->string screen_width) "x" (number->string screen_height)
        "/statusline.png")
      'pos (list statusx statusy)
      'text-pos (list (+ statusx 6) (+ statusy 2))
      'font 'game)
</pre>
</dd>
<dt>menu-button</dt>
<dd>
<pre>
    'menu-button (list
      'pos (list (+ minimapx 28) (+ minimapy 148))
      'size '(128 19)
      'caption "Menu (~<F10~>)"
      'style 'main)
</pre>
</dd>
<dt>network-menu-button</dt>
<dd>
<pre>
    'network-menu-button '(
      pos (6 2)
      size (80 19)
      caption "Menu"
      style network)
</pre>
</dd>
<dt>network-diplomacy-button</dt>
<dd>
<pre>
    'network-diplomacy-button '(
      pos (90 2)
      size (80 19)
      caption "Diplomacy"
      style network)
</pre>
</dd>
<dt>info-buttons</dt>
<dd>Position of the unit icons on the info panel. Example:
<pre>
    'info-buttons (list
      (list 'pos (list (+ infox   9) (+ infoy 8)) 'size '(46 38))
      (list 'pos (list (+ infox  65) (+ infoy 8)) 'size '(46 38))
      (list 'pos (list (+ infox 121) (+ infoy 8)) 'size '(46 38))
      (list 'pos (list (+ infox   9) (+ infoy 62)) 'size '(46 38))
      (list 'pos (list (+ infox  65) (+ infoy 62)) 'size '(46 38))
      (list 'pos (list (+ infox 121) (+ infoy 62)) 'size '(46 38))
      (list 'pos (list (+ infox   9) (+ infoy 116)) 'size '(46 38))
      (list 'pos (list (+ infox  65) (+ infoy 116)) 'size '(46 38))
      (list 'pos (list (+ infox 121) (+ infoy 116)) 'size '(46 38)))
</pre>
</dd>
<dt>training-buttons</dt>
<dd>Position of the unit icons in the training queue. Should be the
same positions as info-buttons above but without the last
three. (FIXME: is this a requirement?)
</dd>
<dt>button-buttons</dt>
<dd>Position of the action buttons (attack, move, etc.). Currently
there must be nine of them, and they must be on the button panel. Same
syntax as above.
</dd>
<dt>cursors</dt>
<dd>
<pre>
    'cursors '(
      point cursor-point
      glass cursor-glass
      cross cursor-cross
      yellow cursor-yellow-hair
      green cursor-green-hair
      red cursor-red-hair
      scroll cursor-scroll
      arrow-e cursor-arrow-e
      arrow-ne cursor-arrow-ne
      arrow-n cursor-arrow-n
      arrow-nw cursor-arrow-nw
      arrow-w cursor-arrow-w
      arrow-sw cursor-arrow-sw
      arrow-s cursor-arrow-s
      arrow-se cursor-arrow-se)
</pre>
</dd>
<dt>menu-panels</dt>
<dd>FIXME: this really needs docu or change, if you dig out the
requirement of the pictures, write them down here. Example:
<pre>
    'menu-panels (list
      'panel1 (string-append "graphics/ui/" race "/panel_1.png")
      'panel2 (string-append "graphics/ui/" race "/panel_2.png")
      'panel3 (string-append "graphics/ui/" race "/panel_3.png")
      'panel4 (string-append "graphics/ui/" race "/panel_4.png")
      'panel5 (string-append "graphics/ui/" race "/panel_5.png"))
</pre>
</dd>
<dt>victory-background</dt>
<dd>Background image for the victory screen. The image will be scaled. Example:
<pre>
    'victory-background (string-append "graphics/ui/" race "/victory.png")
</pre>
</dd>
<dt>defeat-background</dt>
<dd>Background image for the victory screen. The image will be scaled. Example:
<pre>
    'defeat-background (string-append "graphics/ui/" race "/defeat.png")
</pre>
</dd>
</dl>

<a name="define-viewports"></a>
<h3>(define-viewports 'mode mode 'viewport (mapx mapy) ...)</h3>

Define the viewports. Only used in savegames, but could be useful for
scenarios.

<dl>
<dt>mode</dt>
<dd>Number corresponding to the viewport mode.  See the ViewportMode enum.
</dd>
<dt>mapx</dt>
<dd>X coordinate of the map tile.
</dd>
<dt>mapy</dt>
<dd>Y coordinate of the map tile.
</dd>
</dl>

<h4>Example</h4>
<pre>
    ;; Defines the viewports to use mode 1 (split horizontal) with the first
    ;; viewport having map coordinates 82,31 and the second having coordinates 64,31.
    (define-viewports 'mode 1
      'viewport '(82 31)
      'viewport '(64 31))
</pre>


<h4>Not Used</h4>

<a name="display-picture"></a>
<h3>(display-picture file)</h3>

Display a picture.


<dl>
<dt>file</dt>
<dd>Path to the image graphic.
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Displays the picture.
    (display-picture "graphics/ui/stratagus.png")
</pre>

<h4>Not Used</h4>

<a name="process-menu"></a>
<h3>(process-menu id)</h3>

Process a menu.


<dl>
<dt>id</dt>
<dd>ID of the menu.
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Process the menu 'menu-program-start.
    (process-menu 'menu-program-start)
</pre>

<h4>Not Used</h4>

<a name="set-game-cursor!"></a>
<h3>(set-game-cursor! ident)</h3>

Set the game cursor.


<dl>
<dt>ident</dt>
<dd>Unique identifier of the cursor.
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Set the game cursor to 'cursor-point.
    (set-game-cursor! 'cursor-point)
</pre>

<h4>Not Used</h4>

<hr>
Last changed: $Id$<br>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2003 by <a href="http://stratagus.org">
The Stratagus Project</a></address></body></html>

