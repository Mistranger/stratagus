<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2002-2003 by Lutz Sammer

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; version 2 dated June, 1991.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Stratagus Configuration Language Description: Tileset</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
    <meta name="Author" content="johns98@gmx.net">
    <meta name="Keyword" content="ccl,magic,spells">
    <meta name="Description" content="">
</head>
<body>
    <h1>Stratagus Configuration Language Description: Magic</h1>
<hr><pre width=80>
         _________ __                 __                               
        /   _____//  |_____________ _/  |______     ____  __ __  ______
        \_____  \\   __\_  __ \__  \\   __\__  \   / ___\|  |  \/  ___/
        /        \|  |  |  | \// __ \|  |  / __ \_/ /_/  >  |  /\___ \ 
       /_______  /|__|  |__|  (____  /__| (____  /\___  /|____//____  >
               \/                  \/          \//_____/            \/ 
    ______________________                           ______________________
			  T H E   W A R   B E G I N S
	   Stratagus - A free fantasy real time strategy game engine
</pre>
<p><b>(C) Copyright 1998-2003 by The Stratagus Project. Distributed under the
<a href="../gpl.html">"GNU General Public License"</a></b>
<hr>
<a href="../stratagus.html">Stratagus</a> 
<a href="../readme.html">Readme</a> 
<a href="../faq.html">FAQ</a> 
<a href="ccl.html">CCL</a> 
<a href="icon.html">PREV</a> 
<a href="pud.html">NEXT</a> 
<a href="ccl-index.html">Index</a> 
<hr>
<a href="#define-missile-type">define-missile-type</a>
<a href="#define-spell">define-spell</a>
<a href="pud.html#define-missiletype-wc-names">define-missiletype-wc-names</a>
<a href="#missile">missile</a>
<hr>
<h2>Intro - Introduction to spells and missiles.</h2>
This containts everything around spells and missiles. Though it might not be
obvious at start missiles are also suited for complex behaviour and included here.

<h2>Functions</h2>
<a name="define-missile-type"></a>


<h3>(define-missile-type 'missile-name 'tag 'value ....)</h3>

This is the function to define a missile type.
<dl>
<dt>missile-name</dt>
<dd>This is the unique identifier of the missile.
</dd>
</dl>
Possible tags:
<dl>
<dt>file</dt>
<dd>This is followed by the path of the file with the missile graphics.
</dd>
<dt>size</dt>
<dd>This if followed by a list of X and Y sizes of the missile sprite.
F.E. 'size '(32 32)
</dd>
<a name="frames-define-missile-type"></a>
<dt>frames</dt>
<dd>This is the number of frames in the file. Missiles lack complicated
animation scripts and just have a bunch of frames with equal duration.
</dd>
<dt>num-directions</dt>
<dd>The number of directions in the file for the missile. Should be 8.
</dd>
<dt>draw-level</dt>
<dd>The draw level of the missile. Missiles and units are sorted by this
value to determine the draw order.
</dd>
<dt>fired-sound</dt>
<dd>Name of the sound played when the missile is fired.
</dd>
<dt>impact-sound</dt>
<dd>Name of the sound played when the missile hits it's target.
</dd>
<dt>class</dt>
<dd>Various missiles can have wierd behaviours. This tag is followed by an 
identifier that specifies some of that behaviour. Here is a list of currently
supported missile classes:
<ul>
    <li>missile-class-none 
    <li>missile-class-point-to-point 
    <li>missile-class-point-to-point-with-delay 
    <li>missile-class-stay-with-delay 
    <li>missile-class-point-to-point-3bounces 
    <li>missile-class-fireball 
    <li>missile-class-flame-shield 
    <li>missile-class-blizzard 
    <li>missile-class-death-decay 
    <li>missile-class-whirlwind 
    <li>missile-class-cycle-once 
    <li>missile-class-point-to-point-with-hit 
    <li>missile-class-fire 
    <li>missile-class-custom 
    <li>missile-class-hit 
</ul>
FIXME: add documentation for each missile behaviour
</dd>
<a name="delay-define-missile-type"></a>
<dt>delay</dt>
<dd>Delay in game cycles after the missile generation, until the missile
animation and effects starts. Delay denotes the number of display cycles to
skip before drawing the first sprite frame and only happens once at start.
</dd>
<dt>sleep</dt>
<dd>This are the number of game cycles to wait for the next animation or the
sleeping between the animation steps. All animations steps use the same delay.
0 is the fastest and 255 the slowest animation. Perhaps we should later we
will use animation scripts for more complex animations.
</dd>
<dt>speed</dt>
<dd>The speed how fast the missile moves. 0 the missile didn't move, 1 is the
slowest speed and 32 s the fastest supported speed. This is how many pixels
the missiles moves with each animation step.  The real use of this member
depends on the missile class. This is currently only used by the point-to-point
missiles.
</dd>
<dt>range</dt>
<dd>Determines the range in which a projectile will deal its damage. A range of
0 will mean that the damage will be limited to the targetted unit only.  So if
you shot a missile at a unit, it would only damage that unit.  A value of 1 only
affects the field where the missile hits.  A value of 2  would mean that the
damage for that particular missile would be dealt for a range of 1 around the
impact spot. All fields that aren't the center get only 50% of the damage.
</dd>
<dt>impact-missile</dt>
<dd>You can use this to spawn another missile on impact. F.E. 'impact-missile 'missile-explosion
</dd>
<dt>can-hit-owner</dt>
<dd>This is a boolean value(#t or #f) that determines if the missile will affect
the caster or not.
</dd>
<dt>firendly-fire</dt>
<dd>This is a boolean value(#t or #f) that determines if the missile will damage
units belonging to the same player of the caster or to an ally.
</dd>
</dl>

<h4>Example</h4>

<pre>
    (define-missile-type 'missile-fireball
      'file "missiles/fireball.png" 'size '(32 32) 'frames 5
      'num-directions 8
      'impact-sound "fireball hit"
      'class 'missile-class-point-to-point 'draw-level 50  'sleep 1 'speed 16 'range 1
      'can-hit-owner #f 'friendly-fire #f)
</pre>
<h4>Used</h4>
<a href="../../data/ccl/missiles.ccl"> $LIBARYPATH/ccl/missiles.ccl </a>

<a name="define-spell"></a>
<h3>(define-spell spell-ident tag value ... )</h3>
This is the function to define a spell, icluding it's effects and targetting
conditions.

<dl>
<dt>showname</dt>
<dd>A neatly formatted string to be shown by the engine on the screen.
</dd>
<dt>manacost</dt>
<dd>The mana cost of the spell. Maybe this should be set on a per-caster basis?
</dd>
<dt>range</dt>
<dd>The casting range of the spell, do not confuse this with area effect range.
It's normally an integer value, but you can specify a special value 'infinite to
let the spell be casted on the entire map.
</dd>
<dt>target</dt>
<dd>Target type information. The following values are acceptable:
<ul>
    <li>self: The spell will only affect the caster or the area around him, no targetting at all.
    <li>position: The unit will target a position.
    <li>unit: The unit will target an unit. The spell will be aborted if the target dies. 
</ul>
You can still use position spells on units, it will target the unit's position.
If the unit dies however the caster will stop. (Some spells get casted until
there is no more mana left).
</dd>
<dt>action</dt>
<dd>The effect of the spells. This comes in the form of 'action '(operation-name parameters ... ) <br>
Here are the supported operations , their paramenters, and what they do.<p>
<dl>
    <dt>area-bombardment</dt>
    <dl>This will a number of missiles to be thrown in a square area. Here are
    the available tags:
	<dt>fields</dt>
	<dd>The size of the affected square. This will get centered on the target
	It should really be an odd number, or it will look wierd (not centered.)
	</dd>
	<dt>shards</dt>
	<dd>The amount of missiles to throw at random in the square.
	</dd>
	<dt>damage</dt>
	<dd>The damage of each individual missile.
	</dd>
	</dt>start-offset-x<dt>
	</dt>start-offset-y<dt>
	<dd>A missile hitting x,y will start at x+start-offset-x, y+start-offset-y.
	This value is in pixels, for better precision.
	</dd>
    </dl>
    <dt>adjust-buffs</dt>
    <dl>This spell with set the time left for every buff. Buffs are temporary
	bonuses or penalties for units, like better damage or reduced speed(on enemies)
	when setting buff-1-ticks 567 the unit will have 567 ticks of buff-1 left. 0 is
	also a value, in fact acting like some sort of dispel magic. Unfortunately
	this is quite limited at the moment, here are the buffs provided and what they do.
    	<dt>haste-ticks</dt>
	<dd>The number of haste ticks. Haste gives the unit almost double speed
	for any activity.
	</dd>
    	<dt>haste-ticks</dt>
	<dd>The number of slow ticks. Slow gives the unit double speed for all
	activities.
	</dd>
    	<dt>bloodlust-ticks</dt>
	<dd>The number of bloodlust ticks. Bloodlust gives the unit double damage
	(both piercing and basic)
	</dd>
    	<dt>invisibility-ticks</dt>
	<dd>The number of Invisibility ticks. Invisibility makes the unit completely
	dissapear for other players. It can still be affected by area effect spells
	though. The unit will appear when the time is gone or when it will try to do
	anything except move. This has nothing to do with cloaking.
	</dd>
	<dt>invincibility-ticks</dt>
	<dd>The number of invincibility ticks. This makes the unit completely imune
	to all forms of damage. Try using very low values for this :).
	</dd>
    </dl>
    <dt>adjust-vitals</dt>
    <dl>This will adjust vitals of the unit. Vitals are health, mana, and on a sunny
	day maybe even shield. Possible tags:
	<dt>hit-points</dt>
	<dd>Unit hit-point gain, or loss if negative.
	</dd>
	<dt>mana</dt>
	<dd>Unit mana gain, or loss if negative.
	</dd>
	<dt>max-multi-cast</dt>
	<dd>This spell usually has some very small limits (like heal 2 hit-points
	for 1 caster mana), and will get casted multiple times at once, until the
	hp/mana limit for the unit is reached. You can set this to a reasonable
	value so the spell can only get casted so many times at once. Like heal
	2 hit-points for 1 caster mana up to 20 hit-points/10 mana per cast
	</dd>
    </dl>
    <dt>summon</dt>
    <dl>This will summon a new unit. Possible tags:
	<dt>unit-type</dt>
	<dd>Type of the unit to summon. Must be already defined.
	</dd>
	<dt>ttl</dt>
	<dd>Time to live. The unit will only survive for that time, afterward it
	will receive 1 damage every game cycle, ending it's life. If this is 0
	or ommited then the summoned unit is permanent
	</dd>
	<dt>require-corpse</dt>
	<dd>This flag does not take a value. When specified, the caster will
	summon an unit from a corpse, and consume the corpse in the process.
	You should make sure the summoned unit dies without a corpse.
	</dd>
	How to do a reveal-map spell: define a special unit, give it the 
	'revealer flag, and set the spell's range to 'infinite. Please see
	<a href="unittype.html#define-unit-type">(define-unit-type)</a>
	</dd>
    </dl>
    <dt>polymorph</dt>
    <dl>This will tranform the unit, giving it a new unit type. Before you
	ask, temporary polymorphing is not supported, but it would be a nice
	feature to add in the future. There is only one tag:
	<dt>unit-type</dt>
	<dd>Type of the unit to transform to. Must be already defined. This spell
	can be used as an instant-kill spell by polymorphing into a harmless unit,
	like a chicken.
	</dd>
    </dl>
</dl>
</dd>
</dl>

<h4>Example</h4>
<pre>
    (define-spell "spell-holy-vision"
      'showname "Holy Vision"
      'manacost 70
      'range 'infinit
      'target 'position
      'action '(summon unit-type unit-revealer time-to-live 10)
      'sound-when-cast "holy vision"
      'missile-when-cast "missile-normal-spell"
    )
</pre>
<h4>Used</h4>
<a href="../../data/ccl/spells.ccl"> $LIBARYPATH/ccl/spells.ccl </a>

<a name="missile"></a>
<h3>(missile tag 'value ... )</h3>
This function will define a mid-game missile, and it is mostly used in savegames.
<dl>
<dt>type</dt>
<dd>The type of the missile. Declared with
<a href=#define-missile-type>(define-missile-type)</a>
</dd>
<dt>pos</dt>
<dd>The current position of the missile. It's list of and y values. Coordinates are
in pixels, not tiles. F.E 'pos (4500 3450)
</dd>
<dt>goal</dt>
<dd>The position of the missile's destination. It's list of and y values. Coordinates are
in pixels, not tiles. F.E 'gold (4510 3500)
</dd>
<dt>local</dt>
<dd>This unit is marked as local, and it's visible only to the player. This
is used for instance for cursor marks on the map. Either local or global must be specified.
</dd>
<dt>global</dt>
<dd>This unit is marked as global, and it's visible to all players. Either
local or global must be specified.
</dd>
<dt>frame</dt>
<dd>Current sprite frame of the missile.  The range is from 0 to the 
<a href="#FRAMES-Define-missile-type">type:frames</a>-1
The topmost bit (128) is used as flag to mirror the sprites in the X direction.
</dd>
<dt>state</dt>
<dd>Current state of the missile.  Used for a simple state machine, dependand on
the missile class.
</dd>
<dt>wait</dt>
<dd>Wait this number of game cycles until the next state or animation of this
missile is handled. This counts down from type:sleep to 0.
</dd>
<dt>delay</dt>
<dd>Number of game cycles left until the missile is first shown on the map.
Please see <a href="#delay-define-missile-type">delay in (define-missile-type)</a>
</dd>
<dt>source<dt>
<dd>Number of the owner of the missile. Normally the one who fired the missile.
Used to check units, to prevent hitting the owner. Also used for kill and
experience points, and for giving the owning player score.
</dd>
<dt>target<dt>
<dd>Number of the missile's target. Normally the unit which should be
hit by the missile.
</dd>
<dt>damage<dt>
<dd>Damage done by missile. Units next to it can receive some reduced splash
damage, this is the full damage.
</dd>
<dt>ttl</dt>
<dd>Time to live in game cycles of the missile, if it reaches zero
the missile is automatically removed from the map. If -1 the
missile lives for ever and the lifetime is handled by other means.
</dd>
</dl>

<h4>Example</h4>

<pre>
    (missile 'type-fireball 'pos '(10 10) 'goal '(10 50)
      'global 'state 0 'wait 5 'damage 5000 'source 45 'ttl -1)
</pre>
<h4>Used</h4>

<a href="../../data/ccl/wc2.ccl"> $LIBARYPATH/ccl/wc2.ccl </a>



<hr>
Last changed: $Id$<br>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2003 by <a href="http://stratagus.org">
The Stratagus Project</a></address></body></html>
