<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2002-2003 by Lutz Sammer

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; version 2 dated June, 1991.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Stratagus Configuration Language Description: Magic</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
    <meta name="Author" content="cleonard@go.ro">
    <meta name="Keyword" content="ccl,magic,spells">
    <meta name="Description" content="">
</head>
<body>
    <h1>Stratagus Configuration Language Description: Magic</h1>
<hr><pre width=80>         _________ __ 
         __ /                 _____//                               
        |_____________   _/  |______ ____  __     __  ______ \_____  \\
        __\_  __   \__  \\ __\__  \   /  ___\|   | \/  ___/  /  \|
        |        |  |  \//  __ \| | /  __  \_/ /_/ &gt; |    /\___  \ /_______ 
       /|__|  |__|  (____  /__|  (____ /\___  /|____//____  &gt;  
               \/                  \/          \//_____/            \/ 
    ______________________                           ______________________
			  T H E   W A R   B E G I N S
	   Stratagus - A free fantasy real time strategy game engine
</pre>
<p><b>(C) Copyright 1998-2003 by The Stratagus Project. Distributed under the
<A href="../gpl.html">"GNU General Public License"</a></b>
<hr>
<A href="../stratagus.html">Stratagus</a> 
<A href="../readme.html">Readme</a> 
<A href="../faq.html">FAQ</a> 
<A href="ccl.html">CCL</a> 
<A href="icon.html">PREV</a> 
<A href="pud.html">NEXT</a> 
<A href="ccl-index.html">Index</a> 
<hr>
<A href="#define-missile-type">define-missile-type</a>
<A href="#define-spell">define-spell</a>
<A href="pud.html#define-missiletype-wc-names">define-missiletype-wc-names</a>
<A href="#missile">missile</a>
<hr>
<h2>Intro - Introduction to spells and missiles.</h2>
This containts everything around spells and missiles. Though it might not be
obvious at start missiles are also suited for complex behaviour and included here.

<h2>Functions</h2>
<a name="define-missile-type"></a>


<h3>(define-missile-type 'missile-name 'tag 'value ....)</h3>

This is the function to define a missile type.
<dl>
<dt>missile-name 
  
<dd>This is the unique identifier of the missile.
</dd>
</dl>
Possible tags:
<dl>
<dt>file 
  
<dd>This is followed by the path of the file with the 
  missile graphics. 
  
<dt>size 
  
<dd>This if followed by a list of X and Y sizes of the 
  missile sprite. F.E. 'size '(32 32) 
<a name="frames-define-missile-type"></a>
<dt>frames 
  
<dd>This is the number of frames in the file. Missiles 
  lack complicated animation scripts and just have a bunch of frames with equal 
  duration. 
  
<dt>num-directions 
  
<dd>The number of directions in the file for the missile. 
  Should be 8. 
  
<dt>draw-level 
  
<dd>The draw level of the missile. Missiles and units are 
  sorted by this value to determine the draw order. 
  
<dt>fired-sound 
  
<dd>Name of the sound played when the missile is fired. 
  
<dt>impact-sound 
  
<dd>Name of the sound played when the missile hits it's 
  target. 
  
<dt>class 
  
<dd>Various missiles can have wierd behaviours. This tag is followed by an 
identifier that specifies some of that behaviour. Here is a list of currently
supported missile classes:<p>
<dl>
    <dt>missile-class-none 
    <dd>Missile does nothing. Shouldn't really be used. 
    <dt>missile-class-point-to-point 
    <dd>Missile flies straight to destination animating on 
    the way 
    <dt>missile-class-point-to-point-with-hit 
    <dd>Missile flies straight to destination keeping the 
    first frame and the finishes the animation when hitting 
    <dt>missile-class-point-to-point-cycle-once 
    <dd>Missile flies straight to destination and animates 
    ONCE from first to last and back again. To be used for catapult and the like 
    to make a projectile bigger mid-way to the target 
    <dt>missile-class-point-to-point-bounce 
    <dl>Missile flies straight to destination, and the "bounces" by hitting
	every other tile on the path onward. This will also add one aditional flag:
	<dt>num-bounces 
      
	<dd>This if folowed by an integer, representing the number of bounces(hits)</dd>
    </dl>
    <dt>missile-class-stay 
    <dd>Missile will just go through it's animation once 
    and vanish. booooring. 
    <dt>missile-class-cycle-once 
    <dd>Missile will just go through it's animation from 
    start to and and back again, then vanish. 
    <dt>missile-class-fire 
    <dd>Missile is used for fire. More documentation? 
    <dt>missile-class-parabolic 
    <dd>Missile flies to destination with a parabolic path. 
    It used the same animation as cycle-once 
    <dt>missile-class-land-mine 
    <dd>Missile is a landmine, it will sit quietly and wait for someone to step
    on it. You can use time-to-live as a timeout.<b>FIXME more configurable</b>
    <dt>missile-class-whirlwind 
    <dd>Missile for the whirlwind effect <b>FIXME more configurable</b>
    <dt>missile-class-flame-shield 
    <dd>Missile rotates around target unit and damages everything it touches
    <b>FIXME more configurable</b>
    <dt>missile-class-death-coil 
    <dd>Missile is death coil, will drain health from target or enemy units
    in the area and feed it to the caster.<b>FIXME more configurable</b>
    </dd>
</dl>
<a name="delay-define-missile-type"></a>
<dt>delay 
  
<dd>Delay in game cycles after the missile generation, 
  until the missile animation and effects starts. Delay denotes the number of 
  display cycles to skip before drawing the first sprite frame and only happens 
  once at start. 
  
<dt>sleep 
  
<dd>This are the number of game cycles to wait for the 
  next animation or the sleeping between the animation steps. All animations 
  steps use the same delay. 0 is the fastest and 255 the slowest animation. 
  Perhaps we should later we will use animation scripts for more complex 
  animations. 
  
<dt>speed 
  
<dd>The speed how fast the missile moves. 0 the missile 
  didn't move, 1 is the slowest speed and 32 s the fastest supported speed. This 
  is how many pixels the missiles moves with each animation step. The real use 
  of this member depends on the missile class. This is currently only used by 
  the point-to-point missiles. 
  
<dt>range 
  
<dd>Determines the range in which a projectile will deal 
  its damage. A range of 0 will mean that the damage will be limited to the 
  targetted unit only. So if you shot a missile at a unit, it would only damage 
  that unit. A value of 1 only affects the field where the missile hits. A value 
  of 2 would mean that the damage for that particular missile would be dealt for 
  a range of 1 around the impact spot. All fields that aren't the center get 
  only 1/SpashFactor of the damage. Fields 2 away get 1/(SplashFactor*2), and 
  following... 
  
<dt>splash-factor 
  
<dd>The Splash divisor for damage done with range 
  
<dt>impact-missile 
  
<dd>You can use this to spawn another missile on impact. 
  F.E. 'impact-missile 'missile-explosion 
  
<dt>smoke-missile 
  
<dd>The name of the next (other) missile to generate a 
  trailing smoke. So it can be used to generate a chain of missiles. 
  
<dt>can-hit-owner 
  
<dd>Determines if the missile will affect the caster or 
  not. 
  
<dt>firendly-fire 
  
<dd>Determines if the missile will damage
units belonging to the same player of the caster or to an ally.
</dd>
</dl>

<h4>Example</h4>

<pre>
    (define-missile-type 'missile-fireball
      'file "missiles/fireball.png" 'size '(32 32) 'frames 5
      'num-directions 8
      'impact-sound "fireball hit"
      'class 'missile-class-point-to-point 'draw-level 50  'sleep 1 'speed 16 'range 1
      'can-hit-owner)
</pre>
<h4>Used</h4>
<A href="../../data/ccl/missiles.ccl"> $LIBARYPATH/ccl/missiles.ccl </a>

<a name="define-spell"></a>
<h3>(define-spell spell-ident tag value ... )</h3>
This is the function to define a spell, icluding it's effects and targetting
conditions. Be very carefull, defining random flags will probably make the game crash.

<dl>
<dt>showname 
  
<dd>A neatly formatted string to be shown by the engine 
  on the screen. 
  
<dt>manacost 
  
<dd>The mana cost of the spell. Maybe this should be set 
  on a per-caster basis? 
  
<dt>repeat-cast 
  
<dd>If specified, the caster will cast it again. To be 
  used with spells like area-bombardment to cast it again (area-bombardment is 
  stackable) 
  
<dt>range 
  
<dd>The casting range of the spell, do not confuse this 
  with area effect range. It's normally an integer value, but you can specify a 
  special value 'infinite to let the spell be casted on the entire map. 
  
<dt>target 
  
<dd>Target type information. The following values are acceptable:
<ul>
    <li>self: The spell will only affect the caster or the area around him, no targetting at all.
    <li>position: The unit will target a position.
    <li>unit: The unit will target an unit. The spell will 
    be aborted if the target dies.</li>                
</ul>You can still use position spells on 
  units, it will target the unit's position. If the unit dies however the caster 
  will stop. (Some spells get casted until there is no more mana left). 
  
<dt>conditions 
  
<dd>This is the condition for being able to cast the spell. Think of it as a 
function that takes an unit as a parameter and return either yes or no depending
on the unit properties. Here is how a condition looks like:
<pre>'condition '(
  building false
  max-slow-ticks 10)</pre>
Here are the supported parameters:<p>
<dl>
    <dt>building 
    <dd>This is one of the bool parameters (can't think of a better name). It is
    followed by true, false or only. Imagine this as a question, is the target a
    building? The answer is yes/no. A "true" parameter makes it always pass(and
    it's the default.), "false" parameter passes when the answer is NO, and "only"
    passes only when the answer is yes.<br>
    It doesn't really makes sense to ever say true, since 
    you might just as well ommit it. "building false" means the spell won't work 
    on buildings. "building only" will make a spell that works only on buildings 
    (can't think of any though). This syntax is used for more that "building" 
    <dt>coward 
    <dd>This is a bool parameter too, just like building. I 
    specifies the behaviour for cowards, unit's that don't attack by themselves. 
    For example you should not cast an offensive buff (like bloodlust) on 
    non-combat units. 
    <dt>alliance 
    <dd>This is a bool parameter too, just like building. I 
    specifies the behaviour for allied units. Your own units are considered 
    allied too. For instance you should only cast healing on your own units. 
    <dt>self 
    <dd>This is a bool parameter too, just like building. I it a bit more special,
    since it specifies the behaviour for casting on yourself. <b>A LOT</b> of spells specify "self false", 
    to disallow casting on yourself. 
    <dt>bool-flags 
    <dd>There is no parameter called bool-flags. You can however use flags defined
    by <A href="unittype.html#define-bool-flags">define-bool-flags</a> just 
    like a bool parameter. For instance "organic only" will make a spell work 
    only on units marked with the organic flag. 
    <dt>min-hp-percent 
    <dd>Minimum hp percent of the target. If not specified 
    the minimum is around -10 You can use this to avoid casting damage spells on 
    enemies that are dying anyway. 
    <dt>max-hp-percent 
    <dd>Maximum hp percent of the target. If not specified 
    the maximum is around 1000. For instance you can use this to avoid healing 
    units that are not injured. 
    <dt>min-mana-percent 
    <dd>Minimum mana percent of the target. If not 
    specified the minimum is around -10 You can use this to avoid spells like 
    mana drain on units that are empty. 
    <dt>max-mana-percent 
    <dd>Maximum mana percent of the target. If not 
    specified the maximum is around 1000 For instance you can use this to avoid 
    restoring mana to units that are full. 
    <dt>max-slow-ticks 
    <dd>Followed by a number, to avoid casting slow on an 
    unit that is already slowed down. 
    <dt>max-haste-ticks 
    <dd>Followed by a number, to avoid casting haste on an 
    unit that is already hasted. 
    <dt>max-bloodlust-ticks 
    <dd>Followed by a number, to avoid casting bloodlust on 
    an unit that already has it. 
    <dt>max-invisibility-ticks 
    <dd>Followed by a number, to avoid casting invisibility 
    on an unit that already has it. 
    <dt>max-invincibility-ticks 
    <dd>Followed by a number, to avoid casting invincibility on an unit that already has it.
    </dd>
</dl><p></p>
<dt>autocast 
  
<dd>Autocast works very closely with conditions. Here is the syntax:
<pre>'autocast (range x condition(whatever) )</pre>
It functions by selecting every unit in range and trying to check of they fit the
condition. If they do, the spell is casted. Of course, this is a very primitive
mechanism, but it works for simple spells like heal. As you might have noticed, some
of the finer restrictions in conditions are designed for autocast (like not casting
buffs on cowards). Autocasting position target spells is not supported, sorry.
Here is a formal list of parameters:
<dl>
    <dt>range 
    <dd>The range in which autocast runs. I think it's 
    square? 
    <dt>combat 
    <dd>This is a bool parameter, like in condition. It's 
    autocast-specific and NOT part of conditions due to technical 
    considerations. Combat is not unit-specific, it only depends on caster 
    location. combat mode is when there are non-coward enemy units in range. 
    most offensive spells obviousely only should be used in combat. (can you say 
    offensive buffs?) 
    <dt>condition 
    <dd>This is followed by a list exactly like in 'condition. As it was said
    before, this is evaluated for each and every unit in range, and if a unit
    passes, the spell gets casted.
    </dd>
</dl>
<dt>ai-cast 
  
<dd>This is identical to autocast in syntax. It's used by 
  the AI (computer controller player) rather then by a human players units. In 
  general this should be a little better than autocast (and make human players 
  think some more). There no reason to repeat the syntax of autocast here.<p></p>
<dt>action 
  
<dd>The effect of the spells. You can add multiple actions, here is the syntax:
<pre>'action '((operation-name-1 parameters ... )
          (operation-name-2 parameters ... )
             ...
	  (operation-name-n parameters ... ))
</pre>
Here are the supported operations, their paramenters, and what they do.<p>
<dl>
    <dt>area-bombardment 
    <dl>This will a number of missiles to be thrown in a square area. Here are
    the available tags:
	<dt>fields 
      
	<dd>The size of the affected square. This will get 
      centered on the target It should really be an odd number, or it will look 
      wierd (not centered.) 
      
	<dt>shards 
      
	<dd>The amount of missiles to throw at random in the 
      square. 
      
	<dt>damage 
      
	<dd>The damage of each individual missile. 
      start-offset-x<dt>start-offset-y<dt>
	<dd>A missile hitting x,y will start at x+start-offset-x, y+start-offset-y.
	This value is in pixels, for better precision.
	</dd>
    </dl>
    <dt>adjust-buffs 
    <dl>This spell with set the time left for every buff. Buffs are temporary
	bonuses or penalties for units, like better damage or reduced speed(on enemies)
	when setting buff-1-ticks 567 the unit will have 567 ticks of buff-1 left. 0 is
	also a value, in fact acting like some sort of dispel magic. Unfortunately
	this is quite limited at the moment, here are the buffs provided and what they do.
    	<dt>haste-ticks 
      
	<dd>The number of haste ticks. Haste gives the unit 
      almost double speed for any activity. 
 
    	<dt>haste-ticks 
      
	<dd>The number of slow ticks. Slow gives the unit 
      double speed for all activities. 
 
    	<dt>bloodlust-ticks 
      
	<dd>The number of bloodlust ticks. Bloodlust gives 
      the unit double damage (both piercing and basic) 
 
    	<dt>invisibility-ticks 
      
	<dd>The number of Invisibility ticks. Invisibility 
      makes the unit completely dissapear for other players. It can still be 
      affected by area effect spells though. The unit will appear when the time 
      is gone or when it will try to do anything except move. This has nothing 
      to do with cloaking. 
      
	<dt>invincibility-ticks 
      
	<dd>The number of invincibility ticks. This makes the unit completely imune
	to all forms of damage. Try using very low values for this :).
	</dd>
    </dl>
    <dt>adjust-vitals 
    <dl>This will adjust vitals of the unit. Vitals are health, mana, and on a sunny
	day maybe even shield. Possible tags:
	<dt>hit-points 
      
	<dd>Unit hit-point gain, or loss if negative. 
      
	<dt>mana 
      
	<dd>Unit mana gain, or loss if negative. 
      
	<dt>max-multi-cast 
      
	<dd>This spell usually has some very small limits (like heal 2 hit-points
	for 1 caster mana), and will get casted multiple times at once, until the
	hp/mana limit for the unit is reached. You can set this to a reasonable
	value so the spell can only get casted so many times at once. Like heal
	2 hit-points for 1 caster mana up to 20 hit-points/10 mana per cast
	</dd>
    </dl>
    <dt>demolish 
    <dl>This will remove any trees/rocks/walls in and inflict a fixed damage
    to a fixed area. Possible tags:
    	<dt>damage 
      
	<dd>Each and every unit in range will receive that 
      damage. FIXME: no support for dampening damage. 
      
	<dt>range 
      
	<dd>The range of the terrain and unit damage.
	</dd>
    </dl>
    <dt>summon 
    <dl>This will summon a new unit. Possible tags:
	<dt>unit-type 
      
	<dd>Type of the unit to summon. Must be already 
      defined. 
      
	<dt>ttl 
      
	<dd>Time to live. The unit will only survive for that 
      time, afterward it will receive 1 damage every game cycle, ending it's 
      life. If this is 0 or ommited then the summoned unit is permanent 
      
	<dt>require-corpse 
      
	<dd>This flag does not take a value. When specified, 
      the caster will summon an unit from a corpse, and consume the corpse in 
      the process. You should make sure the summoned unit dies without a corpse. 
      
	How to do a reveal-map spell: define a special unit, give it the 
	'revealer flag, and set the spell's range to 'infinite. Please see
	<A href="unittype.html#define-unit-type">(define-unit-type)</a>           
	            
	          
	</dd></dl>
    <dt>polymorph 
    <dl>This will tranform the unit, giving it a new unit type. Before you
	ask, temporary polymorphing is not supported, but it would be a nice
	feature to add in the future. There is only one tag:
	<dt>unit-type 
      
	<dd>Type of the unit to transform to. Must be already defined. This spell
	can be used as an instant-kill spell by polymorphing into a harmless unit,
	like a chicken.
	</dd>
    </dl>
    <dt>spawn-missile 
    <dl>This will spawn a missile in the game. It's one of the most versatile
    spell variants. Here are the paramenters:
    	<dt>ttl 
      
	<dd>Time to live for the missile. Usually means that 
      the missile is gone after this time, but for some missile classes it means 
      something else. 
 
    	<dt>damage 
      
	<dd>This is the damage for this missile, overriding 
      the standard damage defined for the missile. 
 
    	<dt>delay 
      
	<dd>This is the delay for the missile. it means the 
      missile will only appear after this many ticks. 
      
	<dt>start-point/end-point 
      
	<dl>Point to point-ish missiles need a start and an end point for the
	    trajectory. it is defined like this:
	    <pre>start-point (base caster/target add-x add-y add-rand-x add-rand-y)</pre>
	    The individual tags should be self-explanatory, but here goes:
	    <dt>base 
 
	    <dd>The base for the location calculation. Can be 
        either caster or target. 
 
	    <dt>add-x 
 
	    <dd>How much to add to the x coordinate, in pixels 
 
	    <dt>add-y 
 
	    <dd>How much to add to the y coordinate, in pixels 
 
	    <dt>add-rand-x 
 
	    <dd>Add a random from 0 to value-1 to the x 
        coordinate, in pixels 
 
	    <dt>add-rand-y 
 
	    <dd>Add a random from 0 to value-1 to the y coordinate, in pixels
	    </dd>
	</dl></dt>
    </dl></dt></dl>
	</dd>
    </dl>

<h4>Example</h4>
<pre>
    (define-spell "spell-holy-vision"
      'showname "Holy Vision"
      'manacost 70
      'range 'infinit
      'target 'position
      'action '(summon unit-type unit-revealer time-to-live 10)
      'sound-when-cast "holy vision"
      'missile-when-cast "missile-normal-spell"
    )
</pre>
<h4>Used</h4>
<A href="../../data/ccl/spells.ccl"> $LIBARYPATH/ccl/spells.ccl </a>

<a name="missile"></a>
<h3>(missile tag 'value ... )</h3>
This function will define a mid-game missile, and it is mostly used in savegames.
<dl>
<dt>type 
  
<dd>The type of the missile. Declared with
<A href="#define-missile-type" >(define-missile-type)</a>
<dt>pos 
  
<dd>The current position of the missile. It's list of and 
  y values. Coordinates are in pixels, not tiles. F.E 'pos (4500 3450) 
  
<dt>origin-pos 
  
<dd>The starting position of the missile. It's list of 
  and y values. Coordinates are in pixels, not tiles. F.E 'pos (4505 3455) 
  
<dt>goal 
  
<dd>The position of the missile's destination. It's list 
  of and y values. Coordinates are in pixels, not tiles. F.E 'gold (4510 3460) 
  
<dt>local 
  
<dd>This unit is marked as local, and it's visible only 
  to the player. This is used for instance for cursor marks on the map. Either 
  local or global must be specified. 
  
<dt>global 
  
<dd>This unit is marked as global, and it's visible to 
  all players. Either local or global must be specified. 
  
<dt>frame 
  
<dd>Current sprite frame of the missile.  The range is from 0 to the 
<A href="#FRAMES-Define-missile-type">type:frames</a>-1 The topmost bit 
  (128) is used as flag to mirror the sprites in the X direction. 
  
<dt>state 
  
<dd>Current state of the missile. Used for a simple state 
  machine, dependand on the missile class. 
  
<dt>wait 
  
<dd>Wait this number of game cycles until the next state 
  or animation of this missile is handled. This counts down from type:sleep to 
  0. 
  
<dt>delay 
  
<dd>Number of game cycles left until the missile is first shown on the map.
Please see <A href="#delay-define-missile-type">delay in (define-missile-type)</a>
<dt>source<dt>
<dd>Number of the owner of the missile. Normally the one 
  who fired the missile. Used to check units, to prevent hitting the owner. Also 
  used for kill and experience points, and for giving the owning player score. 
  
<dt>target<dt>
<dd>Number of the missile's target. Normally the unit 
  which should be hit by the missile. 
  
<dt>damage<dt>
<dd>Damage done by missile. Units next to it can receive 
  some reduced splash damage, this is the full damage. 
  
<dt>ttl 
  
<dd>Time to live in game cycles of the missile, if it 
  reaches zero the missile is automatically removed from the map. If -1 the 
  missile lives for ever and the lifetime is handled by other means. 
  
<dt>hidden 
  
<dd>This marks the unit as hidden, until the unit is 
  shown again in the controlling function. No parameters. 
  <DT>transparency&nbsp;
  <DD>Draws the missile with a XX% transparency. Current supported value is 50 
  only.</DD>
</dl>

<h4>Example</h4>

<pre>    (missile 'type-fireball
    'pos '(10 10) 'goal '(10 50) 'global 'state
      0 'wait 5 'damage 5000 'source 45 'ttl -1 'transparency 50)
</pre>
<h4>Used</h4>

<A href="../../data/ccl/wc2.ccl"> $LIBARYPATH/ccl/wc2.ccl </a>



<hr>
Last changed: $Id$<br>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2003 by <a href="http://stratagus.org">
The Stratagus Project</a></address></body></html>
